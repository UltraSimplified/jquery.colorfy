(function(){var e,t,n,r,i,s,o,c,a,l,u,d,h,f,p,g;u={title:/^\s{0,3}\#{1,6}.*$/m,block:/^\s{0,3}>\s+.*$/m,orderedlist:/^\s*[0-9]+\. .+$/m,unorderedlist:/^\s*[*+-] .+$/m,strong:/([\*_]{2})[^\*_]+?\1/m,emphasis:/([\*_])[^\*_]+?\1(?![\*_])/m,strikethrough:/~~.+?~~/m,codeblock:/```[a-z\s]*\n[\s\S]*?\n```/m,inlinecode:/`[^`\n]+?`/,rule:/^[-\*]{3,}/m},c=function(){var e;return e=window.navigator.userAgent,e.indexOf("MSIE ")>0?!0:!1},h=function(e){var t,n,r,i;if(Array.isArray(e))return e;r=[];for(n in e)i=e[n],t={},t[n]=i,r.unshift(t);return r},n=function(e,t,r,i){var s;return s={},s.content=e,s.htmlfier=t,s.descriptor=h(r),s.klass=i,s.subnodes=[],s.supernode=null,s.processed=!1,s.terminate=!1,s.toHTML=function(){var t,n,r,i,o;if(s.processed||s.process(),i=this.klass?"<span class='"+this.klass+"'>":"",e="",this.terminate)e+=this.htmlfier(this.content);else for(o=this.subnodes,n=0,r=o.length;r>n;n++)s=o[n],e+=s.toHTML();return t=this.klass?"</span>":"",i+e+t},s.process=function(){var e,t,r,o,c,a,l,u,d,h,f;if(0===this.descriptor.length)this.terminate=!0;else{d=this.descriptor.pop();for(i in d){for(l=d[i],e=0,u=this.content;r=l.exec(u);)t=!0,h=u.substr(e,r.index),o=r[0],e=o.length+r.index,u=u.substr(e),e=0,h.length>0&&(f=n(h,this.htmlfier,this.descriptor.slice(0),null),this.subnodes.push(f)),c=n(o,this.htmlfier,this.descriptor.slice(0),i),this.subnodes.push(c);a=n(u,this.htmlfier,this.descriptor.slice(0),null),this.subnodes.push(a)}}return s.processed=!0},s},o=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/\//g,"&#x2F;"),e=e.replace(/\n/g,"<br>"),e=e.replace(new RegExp(" ","g"),"&nbsp;")},e=function(e,t,r){var i;return r||(r=o),i=n(e,r,t,"markdown"),i.toHTML()},i=function(t){return e(t,u,o)},s=function(e){return e=e.replace(/<(?!br|\/br).+?>/gm,""),e=e.replace(/<br>/g,"\n"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&amp;/g,"&"),e=e.replace(/&quot;/g,'"'),e=e.replace(/&apos;/g,"'"),e=e.replace(/&#x2F/g,"/"),e=e.replace(/&nbsp;/g," ")},f=function(e){var t;for(t=[e];e=e.parentNode;)t.unshift(e);return t},t=function(e,t){var n,r,i,s,o;if(i=f(e),s=f(t),i[0]!==s[0])return null;for(n=r=0,o=i.length;o>r;n=r+=1)if(i[n]!==s[n])return i[n-1]},r=function(e,n,i,s){var o,c,u,d,h;if(s||(s=e),s===n)return l(n,i);if(!s.contains(n)&&e.contains(t(s,n))&&s.compareDocumentPosition(n)===Node.DOCUMENT_POSITION_FOLLOWING)return a(s);if(!s.contains(n)&&e.contains(t(s,n))&&s.compareDocumentPosition(n)===Node.DOCUMENT_POSITION_PRECEDING)return 0;if(s.contains(n)){for(d=0,h=s.childNodes,c=0,u=h.length;u>c;c++)o=h[c],d+=r(e,n,i,o);return d}},a=function(e){var t,n,r,i,s;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue.length;if("BR"===e.tagName)return 1;if("SPAN"===e.tagName||"DIV"===e.tagName){for(i=0,s=e.childNodes,n=0,r=s.length;r>n;n++)t=s[n],i+=a(t);return i}},l=function(e,t){var n,r,i,s;if(e.nodeType===Node.TEXT_NODE)return t;if("BR"===e.tagName)return console.log("Is this correct behavior?"),t;if("SPAN"===e.tagName||"DIV"===e.tagName){for(i=0,n=r=0,s=t;s>r;n=r+=1)i+=a(e.childNodes[n]);return i}},d=function(e,t){var n,r,i,s;if(a(t)<e)return[];if(t.nodeType===Node.TEXT_NODE)return[t,e];if("BR"===t.tagName)return[t,e];for(s=t.childNodes,r=0,i=s.length;i>r;r++){if(n=s[r],!(a(n)<e))return d(e,n);e-=a(n)}},g=function(e){var t,n,i,s,o;return s=e[0],document.activeElement===s&&(o=window.getSelection(),o.isCollapsed&&(t=o.anchorNode,n=o.anchorOffset,s.contains(t)))?(i=r(s,t,n),e.data("cursorlocation",i)):void 0},p=function(e){var t,n,r,i,s;return r=e[0],document.activeElement===r&&(s=window.getSelection(),s.isCollapsed)?(i=d(e.data("cursorlocation"),r),t=i[0],n=i[1],t&&n>=0?s.collapse(t,n):void 0):void 0},$.fn.colorfy=function(e){var t,n;if(!c())return n=$("<div></div>"),n.attr("contenteditable","true"),n.attr("class",this.attr("class")),n.css("max-height",this.height()),n.css("height",this.height()),n.css("overflow","scroll"),this.after(n),this.css("display","none"),t=this,t.on("keyup paste",function(){return n.data("content",t.val()).trigger("receive-content")}),n.on("receive-content",function(){0===n.text().length?n.css("display","block"):n.css("display","inline-block"),n.html(i(n.data("content"))),p(n)}),n.on("send-content",function(){return 0===n.text().length?n.css("display","block"):n.css("display","inline-block"),t.val(n.data("content"))}),n.on("input paste",function(){return g(n),n.data("content",s(n.html())).trigger("send-content").trigger("receive-content")}),n.data("content",this.val()).trigger("receive-content")}}).call(this);